<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>The Problem with Formal Verification (What We Learned Building Universal Login‚Ää‚Äî‚ÄäPart 2: Security)</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">The Problem with Formal Verification (What We Learned Building Universal Login‚Ää‚Äî‚ÄäPart 2: Security)</h1>
</header>
<section data-field="subtitle" class="p-summary">
This is the second blog post in a series ‚ÄúWhat We Learned Building Universal Login‚Äù:
</section>
<section data-field="body" class="e-content">
<section name="9b6a" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="1d76" id="1d76" class="graf graf--h3 graf--leading graf--title">The Problem with Formal Verification</h3><h4 name="0597" id="0597" class="graf graf--h4 graf-after--h3 graf--subtitle">What We Learned Building Universal Login‚Ää‚Äî‚ÄäPart 2:¬†Security</h4></div><div class="section-inner sectionLayout--outsetColumn"><figure name="d338" id="d338" class="graf graf--figure graf--layoutOutsetCenter graf-after--h4"><img class="graf-image" data-image-id="1*hnOxSPce9XNdN1qW1AWucQ.png" data-width="1500" data-height="1000" data-is-featured="true" src="https://cdn-images-1.medium.com/max/1200/1*hnOxSPce9XNdN1qW1AWucQ.png"></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="1939" id="1939" class="graf graf--p graf-after--figure">This is the second blog post in a series ‚ÄúWhat We Learned Building Universal Login‚Äù:</p><ul class="postList"><li name="f8e5" id="f8e5" class="graf graf--li graf-after--p"><a href="https://medium.com/universal-ethereum/what-we-learned-building-universal-login-part-1-the-problem-6098d600e127" data-href="https://medium.com/universal-ethereum/what-we-learned-building-universal-login-part-1-the-problem-6098d600e127" class="markup--anchor markup--li-anchor" target="_blank">Part 1: The Problem</a></li><li name="5854" id="5854" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Part 2: Security</strong></li><li name="1630" id="1630" class="graf graf--li graf-after--li">Part 3: Developer Experience (coming soon!)</li><li name="2800" id="2800" class="graf graf--li graf-after--li">Part 4: User Experience (coming soon!)</li></ul><h3 name="5dc6" id="5dc6" class="graf graf--h3 graf-after--li">TL;DR</h3><p name="9e99" id="9e99" class="graf graf--p graf-after--h3">To solve onboarding, one needs to solve the security aspect of it. Our takeaways are:</p><ul class="postList"><li name="93b2" id="93b2" class="graf graf--li graf-after--p">To avoid single points of failure, build an ecosystem rather than a single app/API provider</li><li name="ec21" id="ec21" class="graf graf--li graf-after--li">In this use-case, security of smart-contracts is even more crucial than usual</li><li name="0501" id="0501" class="graf graf--li graf-after--li">Formal verification fails, because it is too unstable and expensive, and it forces you to do write-once rather than ongoing development</li><li name="25d5" id="25d5" class="graf graf--li graf-after--li">Gnosis safe contract fits our requirements perfectly and comes with bonuses</li><li name="3994" id="3994" class="graf graf--li graf-after--li">So now we can better focus on our core: solving onboarding, with the best possible UX and dev experience</li></ul><h3 name="1084" id="1084" class="graf graf--h3 graf-after--li">Security</h3><p name="929e" id="929e" class="graf graf--p graf-after--h3">As described in <a href="https://medium.com/universal-ethereum/what-we-learned-building-universal-login-part-1-the-problem-6098d600e127" data-href="https://medium.com/universal-ethereum/what-we-learned-building-universal-login-part-1-the-problem-6098d600e127" class="markup--anchor markup--p-anchor" target="_blank">part 1 of this series</a>, <strong class="markup--strong markup--p-strong">security</strong> is one of three sets of challenges to solve user onboarding to Ethereum (the other two are user experience and developer experience) and it consist of many smaller sub-problems, each affecting each other:</p><ul class="postList"><li name="3f8f" id="3f8f" class="graf graf--li graf-after--p">Private key getting lost or stolen leads to loss of funds</li><li name="4ad9" id="4ad9" class="graf graf--li graf-after--li">A single smart contract‚Äôs vulnerability can lead to catastrophic failure</li><li name="43f2" id="43f2" class="graf graf--li graf-after--li">Solving onboarding also means solving the custodial vs. non-custodial trade-off. Custodial: can be easy to use, but funds are only as secure as your custodian. Non-custodial: hard to use, as secure as your setup, but not easy to properly secure.</li><li name="21dc" id="21dc" class="graf graf--li graf-after--li">Finally, once you solve all of those problems, you need to explain how it all works and build a brand that people trust.</li></ul><h3 name="809c" id="809c" class="graf graf--h3 graf-after--li">No single point of¬†failure</h3><p name="3c3f" id="3c3f" class="graf graf--p graf-after--h3">Our general philosophy around solving security is to avoid a single point of failure (SPOF) as much as possible, by using a multisig wallet.</p><p name="de17" id="de17" class="graf graf--p graf-after--p"><a href="https://emojipedia.org/key/" data-href="https://emojipedia.org/key/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">üîë</a> Private key lost?‚Ää‚Äî‚Ääno problem you store multiple keys on different devices, you can use other devices to reconnect to your funds</p><p name="8249" id="8249" class="graf graf--p graf-after--p"><a href="https://emojipedia.org/key/" data-href="https://emojipedia.org/key/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">üîë</a> Private key stolen?‚Ää‚Äî‚Ääno problem, each key has limited permissions (once the amount of money is big enough to justify extra security)</p><p name="10a2" id="10a2" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">But what about other SPOFs?</strong></p><p name="b92a" id="b92a" class="graf graf--p graf-after--p"><a href="https://emojipedia.org/locked/" data-href="https://emojipedia.org/locked/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">üîí</a> custodian (a 3rd party that stores funds)<br><a href="https://emojipedia.org/locked/" data-href="https://emojipedia.org/locked/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">üîí</a> application (a wallet or dapp potentially hackable)<br><a href="https://emojipedia.org/locked/" data-href="https://emojipedia.org/locked/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">üîí</a> domain (vulnerable to hijacking)<br><a href="https://emojipedia.org/locked/" data-href="https://emojipedia.org/locked/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">üîí</a> etc</p><h3 name="6bc5" id="6bc5" class="graf graf--h3 graf-after--p">Ecosystem</h3><p name="03d1" id="03d1" class="graf graf--p graf-after--h3">The problem with multisig wallets, so far, was that they were too hard to use. That is why our goal is to use a thriving ecosystem of apps and wallets. Each one of them can increase your safety.</p><p name="9a26" id="9a26" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">The key to solve onboarding is not to build a dapp or a smart wallet. It is to build a secure ecosystem. That is the only way to avoid a single point of failure in the long run.</strong></p><p name="0cb8" id="0cb8" class="graf graf--p graf-after--p">That also solves the custodial vs non-custodial paradox.</p><p name="a23c" id="a23c" class="graf graf--p graf-after--p">That, unfortunately, leaves one potential point of failure: the smart contract.</p><h3 name="03b1" id="03b1" class="graf graf--h3 graf-after--p">The smart contracts</h3><p name="f52b" id="f52b" class="graf graf--p graf-after--h3">To ensure no single vulnerability in a smart contract is a key to build a multisig. We were very aware of this critical problem from the very beginning.</p><p name="6f55" id="6f55" class="graf graf--p graf-after--p">From the first days of our research, we were investing heavily in security. Our first approach was to use formal verification.</p><h3 name="c354" id="c354" class="graf graf--h3 graf-after--p">Formal verification</h3><p name="f8fc" id="f8fc" class="graf graf--p graf-after--h3">We assumed that with formal verification (FV):</p><ul class="postList"><li name="7568" id="7568" class="graf graf--li graf-after--p">we could move fast with confidence (by doing ongoing formal verification as we kept developing smart contracts)</li><li name="0e9f" id="0e9f" class="graf graf--li graf-after--li">we could hire a person in-house to work on it to propagate necessary skills within the team</li></ul><p name="0ad1" id="0ad1" class="graf graf--p graf-after--li">Soon Tomasz, a PhD in computer science, with specialization in blockchain and a background in formal verification, joined our team.</p><p name="22bc" id="22bc" class="graf graf--p graf-after--p">We used a well tested technological stack: K (formal verification language), KEVM (EVM specification in K), and ACT (high-level specification language build by DApphub‚Ää‚Äî‚Ääa team working on formal verification of Maker).</p><figure name="6b2a" id="6b2a" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*x4jKDeFCNNQNbeL3.png" data-width="1216" data-height="750" src="https://cdn-images-1.medium.com/max/800/0*x4jKDeFCNNQNbeL3.png"><figcaption class="imageCaption">The ecosystem for creating proofs on¬†EVM</figcaption></figure><p name="8120" id="8120" class="graf graf--p graf-after--figure">As a by-product of that work with co-op with Tomek, I wrote a series of blog posts on formal verification available here: part <a href="https://medium.com/ethworks/formal-verification-for-n00bs-part-1-b4781db2a383" data-href="https://medium.com/ethworks/formal-verification-for-n00bs-part-1-b4781db2a383" class="markup--anchor markup--p-anchor" target="_blank">1</a>, <a href="https://medium.com/ethworks/formal-verification-for-n00bs-part-2-proving-the-correctness-of-a-token-74085f5cd6c1" data-href="https://medium.com/ethworks/formal-verification-for-n00bs-part-2-proving-the-correctness-of-a-token-74085f5cd6c1" class="markup--anchor markup--p-anchor" target="_blank">2</a>, <a href="https://medium.com/ethworks/formal-verification-for-n00bs-part-3-an-attempt-to-prevent-classic-hack-with-klab-8e8d13318086" data-href="https://medium.com/ethworks/formal-verification-for-n00bs-part-3-an-attempt-to-prevent-classic-hack-with-klab-8e8d13318086" class="markup--anchor markup--p-anchor" target="_blank">3</a>, <a href="https://medium.com/ethworks/formal-verification-for-n00bs-part-4-understanding-k-language-6069c20cfd47" data-href="https://medium.com/ethworks/formal-verification-for-n00bs-part-4-understanding-k-language-6069c20cfd47" class="markup--anchor markup--p-anchor" target="_blank">4</a>.</p><p name="8d77" id="8d77" class="graf graf--p graf-after--p">Our initial work showed much promise: in 2‚Äì3 months, we learned basics of formal verification, formally proved one of the critical contracts (KeyHolder that store keys), and added formal verification to our continuous integration.</p><p name="4231" id="4231" class="graf graf--p graf-after--p">Boy, we thought we had it solved! We were wrong.</p><h3 name="80a0" id="80a0" class="graf graf--h3 graf-after--p">Challenges of Formal Verification</h3><p name="7e19" id="7e19" class="graf graf--p graf-after--h3">Unfortunately, in the fourth month, we realized we were far from success, as problems started to pile up:</p><ul class="postList"><li name="bbfb" id="bbfb" class="graf graf--li graf-after--p">proving loops and signatures turned out to be quite challenging</li><li name="3ebe" id="3ebe" class="graf graf--li graf-after--li">the formal verification started taking more and more time (before it was launched after each commit, now only at night)</li><li name="f2c7" id="f2c7" class="graf graf--li graf-after--li">we have to keep adding additional code to smart-contracts to make FV work</li><li name="c96e" id="c96e" class="graf graf--li graf-after--li">small changes in code could result in significant changes in proofs</li><li name="66f8" id="66f8" class="graf graf--li graf-after--li">small changes in proofs could lead to significant changes in the speed of verification</li></ul><blockquote name="fad2" id="fad2" class="graf graf--blockquote graf-after--li">Swap <em class="markup--em markup--blockquote-em">a+b</em> to <em class="markup--em markup--blockquote-em">b+a</em> in a proof could add (or subtract) an extra hour to your proving time</blockquote><p name="8f1b" id="8f1b" class="graf graf--p graf-after--blockquote">By the end of the fourth month, formally verifying one not-too-complicated contract would take close to four hours. It was maybe 10% of our solidity code base.</p><p name="52b7" id="52b7" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">It was becoming evident that:</strong></p><ul class="postList"><li name="19a2" id="19a2" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">you need to modify your code and fine-tune proofs heavily to make it work at all</strong></li><li name="46f0" id="46f0" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">continuous formal verification is too troublesome to be cost-effective</strong></li></ul><blockquote name="6fe5" id="6fe5" class="graf graf--blockquote graf-after--li"><strong class="markup--strong markup--blockquote-strong">To work effectively with FV, one has to use a ‚Äúwrite once, verify once‚Äù approach, rather than ongoing verification</strong></blockquote><p name="da0c" id="da0c" class="graf graf--p graf-after--blockquote">We also learned that other teams using formal verification were running into other significant problems:</p><ul class="postList"><li name="423f" id="423f" class="graf graf--li graf-after--p">they verify most of the code automatically while leaving the hardest parts to manual formal verification on paper</li><li name="e347" id="e347" class="graf graf--li graf-after--li">a small bug in proofs could lead to falsely verified code</li></ul><p name="12a8" id="12a8" class="graf graf--p graf-after--li">And so we decided to investigate other approaches that would give us confidence and allow us to iterate faster.</p><h3 name="4d47" id="4d47" class="graf graf--h3 graf-after--p">Gnosis Safe</h3><p name="86e7" id="86e7" class="graf graf--p graf-after--h3">Gnosis Safe‚Ää‚Äî‚Ääa smart wallet contract- was a source for inspiration for us from the very beginning.</p><figure name="6793" id="6793" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*EROmAMLgvtuPzCfg.png" data-width="1060" data-height="530" src="https://cdn-images-1.medium.com/max/800/0*EROmAMLgvtuPzCfg.png"></figure><p name="1f6b" id="1f6b" class="graf graf--p graf-after--figure">As we were running pilots and gaining understanding of what is it that users and developers need, we discovered that Gnosis Safe contracts matured and they were very aligned with what we are building.</p><blockquote name="44e9" id="44e9" class="graf graf--blockquote graf-after--p"><em class="markup--em markup--blockquote-em">Gnosis Safe, smart contracts were built by a rock-solid team, formally verified by authors of K, audited, and battle-tested. Moreover, they have almost all the functionalities we would like to build in the upcoming months.</em></blockquote><h3 name="3f96" id="3f96" class="graf graf--h3 graf-after--blockquote">Bonus</h3><p name="d0b9" id="d0b9" class="graf graf--p graf-after--h3">Gnosis Safe comes with a bunch of additional benefits:</p><ul class="postList"><li name="46d6" id="46d6" class="graf graf--li graf-after--p"><strong class="markup--strong markup--li-strong">The brand: </strong>It takes time and testing to convince people that your smart contract code is safe. Gnosis Safe has already done that.</li><li name="6e57" id="6e57" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Modules: </strong>That allow extending functionality. A bunch of great modules already exist.</li></ul><blockquote name="b1b3" id="b1b3" class="graf graf--blockquote graf-after--li">Thanks to Gnosis Safe contracts, Universal Login starting day one has support for great features like state channels and daily limits.</blockquote><h3 name="7d09" id="7d09" class="graf graf--h3 graf-after--blockquote">What‚Äôs next?</h3><p name="926e" id="926e" class="graf graf--p graf-after--h3">Security is just a part of a puzzle. Even the best security is worth nothing without adoption.</p><p name="e40f" id="e40f" class="graf graf--p graf-after--p">Before you can build adoption among users, you have to build adoption among developers. And so, user experience and developer experience are the topics of the next two posts in the series. Stay tuned.</p><h3 name="2040" id="2040" class="graf graf--h3 graf-after--p">Follow us!</h3><p name="3fcd" id="3fcd" class="graf graf--p graf-after--h3">To make sure you don‚Äôt miss the next posts in the series, follow us <a href="https://medium.com/universal-ethereum" data-href="https://medium.com/universal-ethereum" class="markup--anchor markup--p-anchor" target="_blank">Medium</a> and <a href="https://twitter.com/unilogin" data-href="https://twitter.com/unilogin" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Twitter</a>.</p><h3 name="8267" id="8267" class="graf graf--h3 graf-after--p">Pilot program</h3><p name="171e" id="171e" class="graf graf--p graf-after--h3">Still not signed-up for our Beta program? Fix it!</p><p name="f355" id="f355" class="graf graf--p graf-after--p graf--trailing"><a href="http://tiny.cc/unilogin" data-href="http://tiny.cc/unilogin" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Join our Pilot program</a> üëÆüèΩ üõ©</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@marekkirejczyk" class="p-author h-card">Marek Kirejczyk</a> on <a href="https://medium.com/p/2e49ca4e7319"><time class="dt-published" datetime="2020-02-03T23:22:18.328Z">February 3, 2020</time></a>.</p><p><a href="https://medium.com/@marekkirejczyk/what-we-learned-building-universal-login-part-1-security-2e49ca4e7319" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on September 22, 2025.</p></footer></article></body></html>