---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ShareButton from '../../components/ShareButton.astro';
import { getAllPosts, formatDate } from '../../utils/posts';

export async function getStaticPaths() {
  const posts = await getAllPosts();
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = post;
const { title, date, heroImage } = post.frontmatter;
const formattedDate = formatDate(date);
const displayImage = heroImage === 'Unknown image' ? '/images/placeholder.svg' : heroImage;
---

<BaseLayout 
  title={title} 
  description={title}
  ogImage={displayImage}
  ogType="article"
>
  <article class="post">
    <div class="post-container">
      <header class="post-header">
        <h1 class="post-title">{title}</h1>
        
        <div class="post-meta">
          <div class="author">
            <img 
              src="https://pbs.twimg.com/profile_images/692445308668682240/cEqpfN66_400x400.jpg" 
              alt="zkMarek"
              class="author-avatar"
            />
            <div class="author-info">
              <a href="https://x.com/zkmarek" target="_blank" rel="noopener noreferrer" class="author-name">
                zkMarek
              </a>
              <span class="post-date">{formattedDate}</span>
            </div>
          </div>
        </div>

        {heroImage !== 'Unknown image' && (
          <div class="post-hero-image">
            <img src={displayImage} alt={title} />
          </div>
        )}
      </header>

      <div class="post-actions">
        <ShareButton title={title} url={post.url} />
        <button class="bookmark-button" id="bookmarkButton" title="Bookmark this page">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
          </svg>
        </button>
      </div>

      <div class="post-content">
        <Content />
      </div>
    </div>
  </article>
</BaseLayout>

<script>
  function initBookmark() {
    const bookmarkButton = document.getElementById('bookmarkButton');
    
    if (!bookmarkButton) return;

    bookmarkButton.addEventListener('click', () => {
      if (window.sidebar && window.sidebar.addPanel) {
        // Firefox
        window.sidebar.addPanel(document.title, window.location.href, '');
      } else if (window.external && ('AddFavorite' in window.external)) {
        // IE
        window.external.AddFavorite(window.location.href, document.title);
      } else {
        // Modern browsers - use Ctrl/Cmd+D prompt
        alert('Please use Ctrl+D (Cmd+D on Mac) to bookmark this page');
      }
    });
  }

  initBookmark();
  document.addEventListener('astro:page-load', initBookmark);
</script>

<style>
  .post {
    width: 100%;
  }

  .post-container {
    max-width: 680px;
    margin: 0 auto;
  }

  .post-header {
    margin-bottom: 48px;
  }

  .post-title {
    font-size: 42px;
    font-weight: 700;
    line-height: 1.2;
    margin-bottom: 24px;
    color: #000000;
  }

  .post-meta {
    margin-bottom: 32px;
  }

  .author {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .author-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    object-fit: cover;
  }

  .author-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .author-name {
    font-weight: 600;
    font-size: 16px;
    color: #000000;
  }

  .author-name:hover {
    text-decoration: underline;
  }

  .post-date {
    font-size: 14px;
    color: #666666;
  }

  .post-hero-image {
    margin-top: 32px;
    border-radius: 4px;
    overflow: hidden;
  }

  .post-hero-image img {
    width: 100%;
    height: auto;
    display: block;
  }

  .post-actions {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px 0;
    border-top: 1px solid #f0f0f0;
    border-bottom: 1px solid #f0f0f0;
    margin-bottom: 48px;
  }

  .bookmark-button {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: transparent;
    border: 1px solid #e0e0e0;
    border-radius: 50%;
    color: #666666;
    cursor: pointer;
    transition: all 0.2s;
  }

  .bookmark-button:hover {
    background: #f5f5f5;
    border-color: #d0d0d0;
  }

  .bookmark-button svg {
    width: 20px;
    height: 20px;
  }

  .post-content {
    font-size: 20px;
    line-height: 1.8;
    color: #1a1a1a;
  }

  /* MDX Content Styles */
  .post-content :global(h1),
  .post-content :global(h2),
  .post-content :global(h3),
  .post-content :global(h4),
  .post-content :global(h5),
  .post-content :global(h6) {
    font-weight: 700;
    line-height: 1.3;
    margin-top: 48px;
    margin-bottom: 16px;
    color: #000000;
  }

  .post-content :global(h1) { font-size: 36px; }
  .post-content :global(h2) { font-size: 32px; }
  .post-content :global(h3) { font-size: 28px; }
  .post-content :global(h4) { font-size: 24px; }
  .post-content :global(h5) { font-size: 20px; }
  .post-content :global(h6) { font-size: 18px; }

  .post-content :global(p) {
    margin-bottom: 24px;
  }

  .post-content :global(a) {
    color: #0066cc;
    text-decoration: none;
    border-bottom: 1px solid #0066cc;
  }

  .post-content :global(a:hover) {
    border-bottom: 2px solid #0066cc;
  }

  .post-content :global(ul),
  .post-content :global(ol) {
    margin-bottom: 24px;
    padding-left: 32px;
  }

  .post-content :global(li) {
    margin-bottom: 8px;
  }

  .post-content :global(blockquote) {
    margin: 32px 0;
    padding: 16px 24px;
    border-left: 4px solid #0066cc;
    background: #f9f9f9;
    font-style: italic;
    color: #333333;
  }

  .post-content :global(code) {
    background: #f5f5f5;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: 'Courier New', Courier, monospace;
    font-size: 0.9em;
  }

  .post-content :global(pre) {
    background: #282c34;
    color: #abb2bf;
    padding: 24px;
    border-radius: 8px;
    overflow-x: auto;
    margin: 32px 0;
  }

  .post-content :global(pre code) {
    background: transparent;
    padding: 0;
    color: inherit;
    font-size: 14px;
  }

  .post-content :global(img) {
    max-width: 100%;
    height: auto;
    border-radius: 4px;
    margin: 32px 0;
  }

  .post-content :global(hr) {
    border: none;
    border-top: 1px solid #e0e0e0;
    margin: 48px 0;
  }

  .post-content :global(table) {
    width: 100%;
    border-collapse: collapse;
    margin: 32px 0;
  }

  .post-content :global(th),
  .post-content :global(td) {
    padding: 12px;
    border: 1px solid #e0e0e0;
    text-align: left;
  }

  .post-content :global(th) {
    background: #f5f5f5;
    font-weight: 600;
  }

  @media (max-width: 768px) {
    .post-container {
      max-width: 100%;
    }

    .post-title {
      font-size: 32px;
    }

    .post-content {
      font-size: 18px;
    }

    .post-content :global(h1) { font-size: 28px; }
    .post-content :global(h2) { font-size: 26px; }
    .post-content :global(h3) { font-size: 24px; }
    .post-content :global(h4) { font-size: 22px; }
    .post-content :global(h5) { font-size: 18px; }
    .post-content :global(h6) { font-size: 16px; }

    .post-content :global(pre) {
      padding: 16px;
      font-size: 13px;
    }
  }
</style>

